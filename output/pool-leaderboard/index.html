<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pool Leaderboard</title>
    <style>
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

* {
    box-sizing: border-box;
}

body {
    font-family: 'Inter', -apple-system, BlinkMacSystemFont, system-ui, sans-serif;
    background: #0d1117;
    color: #c9d1d9;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    line-height: 1.4;
}

.container {
    max-width: 1000px;
    padding: 20px;
    margin: 0 auto;
}

/* Authentication Screen */
.auth-screen {
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    min-height: 100vh;
    text-align: center;
}

.auth-title {
    color: #58a6ff;
    font-size: 2.5rem;
    font-weight: 800;
    margin-bottom: 1rem;
    text-shadow: 0 0 10px rgba(88, 166, 255, 0.3);
    display: flex;
    align-items: center;
    gap: 12px;
}

.auth-subtitle {
    color: #7d8590;
    margin-bottom: 2rem;
    font-size: 1.1rem;
    font-weight: 400;
}

.auth-form {
    background: #21262d;
    border: 1px solid #30363d;
    border-radius: 12px;
    padding: 2rem;
    width: 100%;
    max-width: 400px;
    box-shadow: 0 16px 32px rgba(0, 0, 0, 0.4);
}

.auth-input {
    width: 100%;
    padding: 12px 16px;
    margin-bottom: 1rem;
    background: #0d1117;
    border: 1px solid #30363d;
    border-radius: 8px;
    color: #c9d1d9;
    font-family: 'Inter', sans-serif;
    font-size: 1rem;
    transition: all 0.2s ease;
}

.auth-input:focus {
    outline: none;
    border-color: #58a6ff;
    box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3);
}

.btn {
    padding: 12px 24px;
    border: none;
    border-radius: 8px;
    font-family: 'Inter', sans-serif;
    font-size: 1rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s ease;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    text-align: center;
    text-decoration: none;
}

.btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
}

.btn-primary {
    background: #238636;
    color: white;
}

.btn-primary:hover:not(:disabled) {
    background: #2ea043;
    transform: translateY(-1px);
}

.btn-secondary {
    background: #21262d;
    color: #c9d1d9;
    border: 1px solid #30363d;
}

.btn-secondary:hover:not(:disabled) {
    background: #30363d;
}

.btn-danger {
    background: #da3633;
    color: white;
    font-size: 0.75rem;
    padding: 6px 12px;
}

.btn-danger:hover:not(:disabled) {
    background: #f85149;
}

.btn-small {
    padding: 4px 8px;
    font-size: 0.8rem;
    border-radius: 4px;
}

/* Main App */
.app-header {
    text-align: center;
    margin-bottom: 2rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #30363d;
}

.app-title {
    color: #58a6ff;
    font-size: 2.5rem;
    font-weight: 800;
    margin: 0;
    text-shadow: 0 0 15px rgba(88, 166, 255, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 12px;
}

.app-subtitle {
    color: #7d8590;
    margin: 0.5rem 0 0 0;
    font-size: 1.1rem;
    font-weight: 400;
}

.user-info {
    background: #21262d;
    border: 1px solid #30363d;
    border-radius: 8px;
    padding: 0.75rem 1rem;
    margin-bottom: 1rem;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 1rem;
}

.user-name {
    color: #58a6ff;
    font-weight: 600;
    text-transform: capitalize;
}

/* Leaderboard */
.leaderboard {
    background: #21262d;
    border: 1px solid #30363d;
    border-radius: 12px;
    margin-bottom: 2rem;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
}

.leaderboard-header {
    background: #161b22;
    padding: 1rem;
    text-align: center;
    border-bottom: 1px solid #30363d;
}

.leaderboard-title {
    color: #ffd700;
    margin: 0;
    font-size: 1.5rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.leaderboard-table {
    width: 100%;
    border-collapse: collapse;
}

.leaderboard-table th {
    background: rgba(10, 61, 10, 0.8);
    color: #ffd700;
    padding: 12px 16px;
    text-align: left;
    border-bottom: 1px solid #4a7c4a;
    font-size: 1rem;
    font-weight: 600;
}

.leaderboard-table td {
    padding: 12px 16px;
    border-bottom: 1px solid rgba(74, 124, 74, 0.5);
    font-size: 1.1rem;
    transition: all 0.3s ease;
}

.leaderboard-row {
    transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
}

.leaderboard-row:hover {
    background: rgba(255, 215, 0, 0.1);
    transform: scale(1.01);
}

.rank {
    text-align: center;
    font-weight: bold;
    width: 60px;
    font-family: 'Courier New', monospace;
    color: #ffd700;
}

.rank-1 { color: #ffd700; text-shadow: 0 0 8px rgba(255, 215, 0, 0.8); font-size: 1.2em; }
.rank-2 { color: #c0c0c0; text-shadow: 0 0 8px rgba(192, 192, 192, 0.8); font-size: 1.1em; }
.rank-3 { color: #cd7f32; text-shadow: 0 0 8px rgba(205, 127, 50, 0.8); font-size: 1.05em; }

.player-name {
    color: #e8f4e8;
    font-weight: 600;
    text-transform: capitalize;
}

.rating {
    font-weight: 700;
    font-family: 'Courier New', monospace;
    font-size: 1rem;
}

.rating-high { color: #3fb950; }
.rating-medium { color: #58a6ff; }
.rating-low { color: #f85149; }

.win-rate, .games-stats {
    color: #7d8590;
    font-family: 'Courier New', monospace;
}

/* Sections */
.section {
    background: #21262d;
    border: 1px solid #30363d;
    border-radius: 12px;
    margin-bottom: 2rem;
    overflow: hidden;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.2);
}

.section-header {
    background: #161b22;
    padding: 1rem;
    text-align: center;
    border-bottom: 1px solid #30363d;
}

.section-title {
    color: #f0f6fc;
    margin: 0;
    font-size: 1.3rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.section-content {
    padding: 1.5rem;
}

.form-group {
    margin-bottom: 1rem;
}

.form-label {
    display: block;
    color: #c9d1d9;
    margin-bottom: 0.5rem;
    font-weight: 500;
}

.form-select, .form-input {
    width: 100%;
    padding: 12px 16px;
    background: #0d1117;
    border: 1px solid #30363d;
    border-radius: 8px;
    color: #c9d1d9;
    font-family: 'Inter', sans-serif;
    font-size: 0.9rem;
    transition: all 0.2s ease;
}

.form-select:focus, .form-input:focus {
    outline: none;
    border-color: #58a6ff;
    box-shadow: 0 0 0 3px rgba(88, 166, 255, 0.3);
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
}

.form-row-two {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 1rem;
    margin-bottom: 1rem;
}

/* Game Margin Info - Styled like recent games cards */
.margin-info {
    background: rgba(26, 92, 26, 0.4);
    border: 1px solid #4a7c4a;
    border-radius: 8px;
    padding: 1rem;
    margin: 1rem 0;
    font-size: 0.85rem;
    line-height: 1.5;
    transition: all 0.2s ease;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
}

.margin-info:hover {
    border-color: #5a8c5a;
    box-shadow: 0 4px 12px rgba(255, 215, 0, 0.2);
}

.margin-info h4 {
    color: #ffd700;
    margin: 0 0 0.5rem 0;
    font-size: 0.9rem;
    font-weight: 600;
}

.margin-info ul {
    margin: 0.5rem 0;
    padding-left: 1.5rem;
}

.margin-info li {
    margin-bottom: 0.25rem;
    font-family: 'Courier New', monospace;
    color: #e8f4e8;
}

.black-pot-rule {
    color: #ff6666;
    font-size: 0.75rem;
    margin-top: 0.5rem;
    font-style: italic;
}

/* Recent Games */
.recent-games {
    max-height: 450px;
    overflow-y: auto;
    scrollbar-width: thin;
    scrollbar-color: #4a7c4a rgba(26, 92, 26, 0.4);
}

.recent-games::-webkit-scrollbar {
    width: 6px;
}

.recent-games::-webkit-scrollbar-track {
    background: rgba(26, 92, 26, 0.4);
}

.recent-games::-webkit-scrollbar-thumb {
    background: #4a7c4a;
    border-radius: 3px;
}

.game-item {
    background: rgba(26, 92, 26, 0.4);
    border: 1px solid #4a7c4a;
    border-radius: 8px;
    padding: 1rem;
    margin-bottom: 0.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 0.75rem;
    transition: all 0.2s ease;
    position: relative;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
}

.game-item:hover {
    border-color: #5a8c5a;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
    background: rgba(26, 92, 26, 0.6);
    transform: translateY(-1px);
}

.game-result {
    flex: 1;
    min-width: 200px;
}

.game-match {
    font-family: 'Courier New', monospace;
    font-size: 0.9rem;
    margin-bottom: 0.25rem;
}

.game-winner {
    color: #00ff00;
    font-weight: bold;
    text-transform: capitalize;
}

.game-loser {
    color: #ff6666;
    text-transform: capitalize;
}

.game-margin {
    color: #b8d4b8;
    font-size: 0.8rem;
    text-transform: capitalize;
    font-family: 'Courier New', monospace;
}

.game-ratings {
    display: flex;
    gap: 1rem;
    font-size: 0.85rem;
    color: #b8d4b8;
    flex-wrap: wrap;
    font-family: 'Courier New', monospace;
}

.rating-change {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
}

.rating-change-positive {
    color: #00ff00;
    font-weight: bold;
}

.rating-change-negative {
    color: #ff6666;
    font-weight: bold;
}

.game-time {
    color: #b8d4b8;
    font-size: 0.8rem;
    white-space: nowrap;
    font-family: 'Courier New', monospace;
}

.delete-recent-btn {
    width: 100%;
    padding: 12px 16px;
    background: #cc0000;
    border: 1px solid #ff4444;
    border-radius: 8px;
    color: white;
    font-family: 'Inter', sans-serif;
    font-size: 0.9rem;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
    margin-top: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
}

.delete-recent-btn:hover {
    background: #ff0000;
    border-color: #ff6666;
    transform: translateY(-1px);
    box-shadow: 0 4px 8px rgba(204, 0, 0, 0.3);
}

.delete-recent-btn:disabled {
    background: #666;
    border-color: #888;
    cursor: not-allowed;
    opacity: 0.6;
    transform: none;
    box-shadow: none;
}

/* Add Player Section */
.add-player {
    background: #21262d;
    border: 1px solid #30363d;
    border-radius: 12px;
    margin-bottom: 2rem;
    overflow: hidden;
}

/* Rules Section */
.rules-section {
    background: #0a0c10;
    border: 1px solid #30363d;
    border-radius: 12px;
    margin-bottom: 2rem;
    overflow: hidden;
}

.rules-content {
    padding: 1.5rem;
}

.rules-content h4 {
    color: #58a6ff;
    margin: 0 0 1rem 0;
    font-size: 1rem;
    font-weight: 600;
}

.rules-content p, .rules-content li {
    font-family: 'Courier New', monospace;
    font-size: 0.85rem;
    line-height: 1.6;
    color: #8b949e;
}

.rules-content ul {
    padding-left: 1.5rem;
    margin: 0.5rem 0;
}

.rules-content li {
    margin-bottom: 0.5rem;
}

/* Messages */
.message {
    padding: 12px 16px;
    border-radius: 8px;
    margin-bottom: 1rem;
    font-family: 'Inter', sans-serif;
    font-weight: 500;
    display: flex;
    align-items: center;
    gap: 8px;
}

.message-success {
    background: rgba(0, 51, 0, 0.6);
    border: 1px solid #00ff00;
    color: #00ff00;
}

.message-error {
    background: rgba(51, 0, 0, 0.6);
    border: 1px solid #ff6666;
    color: #ff6666;
}

.message-info {
    background: rgba(51, 51, 0, 0.6);
    border: 1px solid #ffd700;
    color: #ffd700;
}

/* Loading States */
.loading {
    text-align: center;
    color: #b8d4b8;
    padding: 2rem;
}

.spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 2px solid #4a7c4a;
    border-radius: 50%;
    border-top-color: #ffd700;
    animation: spin 1s ease-in-out infinite;
    margin-right: 0.5rem;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Slot Machine Counter Animation */
.rating-counter {
    display: inline-block;
    position: relative;
    overflow: hidden;
    height: 1.2em;
    line-height: 1.2em;
}

.rating-digit {
    display: inline-block;
    transition: transform 0.6s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.rating-digit.rolling {
    animation: slotMachineRoll 0.6s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slotMachineRoll {
    0% { transform: translateY(0); }
    25% { transform: translateY(-100%); }
    50% { transform: translateY(-200%); }
    75% { transform: translateY(-300%); }
    100% { transform: translateY(0); }
}

/* Alternative rolling effect for larger changes */
.rating-digit.big-roll {
    animation: slotMachineBigRoll 1.2s cubic-bezier(0.4, 0, 0.2, 1);
}

@keyframes slotMachineBigRoll {
    0% { transform: translateY(0) rotateX(0deg); }
    20% { transform: translateY(-50%) rotateX(180deg); }
    40% { transform: translateY(-100%) rotateX(360deg); }
    60% { transform: translateY(-150%) rotateX(540deg); }
    80% { transform: translateY(-200%) rotateX(720deg); }
    100% { transform: translateY(0) rotateX(900deg); }
}

.counter-animation {
    animation: counterPulse 0.3s ease-out;
}

@keyframes counterPulse {
    0% { transform: scale(1); }
    50% { transform: scale(1.1); }
    100% { transform: scale(1); }
}

/* Position Change Animation */
@keyframes slideUp {
    from { transform: translateY(40px); background: rgba(59, 130, 246, 0.1); }
    to { transform: translateY(0); background: transparent; }
}

@keyframes slideDown {
    from { transform: translateY(-40px); background: rgba(239, 68, 68, 0.1); }
    to { transform: translateY(0); background: transparent; }
}

.position-up {
    animation: slideUp 0.6s ease-out;
}

.position-down {
    animation: slideDown 0.6s ease-out;
}

/* Responsive Design */
@media (max-width: 768px) {
    .container {
        padding: 10px;
    }
    
    .app-title, .auth-title {
        font-size: 2rem;
    }
    
    .auth-form {
        padding: 1.5rem;
    }
    
    .form-row {
        grid-template-columns: 1fr;
        gap: 0.5rem;
    }
    
    .form-row-two {
        grid-template-columns: 1fr;
        gap: 0.5rem;
    }
    
    .leaderboard-table {
        font-size: 0.8rem;
    }
    
    .leaderboard-table th,
    .leaderboard-table td {
        padding: 8px 6px;
    }
    
    .game-item {
        flex-direction: column;
        align-items: flex-start;
    }
    
    .game-ratings {
        justify-content: space-between;
        width: 100%;
    }
}

@media (max-width: 480px) {
    .app-title, .auth-title {
        font-size: 1.5rem;
    }
    
    .leaderboard-table th:nth-child(4),
    .leaderboard-table td:nth-child(4),
    .leaderboard-table th:nth-child(5),
    .leaderboard-table td:nth-child(5) {
        display: none;
    }
}

/* Utilities */
.hidden {
    display: none !important;
}

.text-center {
    text-align: center;
}

.mt-1 { margin-top: 0.5rem; }
.mt-2 { margin-top: 1rem; }
.mb-1 { margin-bottom: 0.5rem; }
.mb-2 { margin-bottom: 1rem; }

/* Lucide Icons */
.lucide {
    width: 20px;
    height: 20px;
    stroke: currentColor;
    stroke-width: 2;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
}

.lucide-lg {
    width: 24px;
    height: 24px;
}
</style>
</head>
<body>
    <html>
<div class="container">
    <!-- Authentication Screen -->
    <div id="authScreen" class="auth-screen">
        <div class="auth-title">
            <svg class="lucide lucide-lg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="8" cy="8" r="2"/><path d="M13.2 17.7c.4-.4.8-.8 1.2-1.2"/><circle cx="16" cy="16" r="2"/></svg>
            POOL LEADERBOARD
        </div>
        <div class="auth-subtitle">Enter your name to access the leaderboard</div>
        <div class="auth-form">
            <input type="text" id="playerNameInput" class="auth-input" placeholder="Enter your player name" autocomplete="off">
            <button id="loginBtn" class="btn btn-primary" style="width: 100%;">
                <svg class="lucide" viewBox="0 0 24 24"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10,17 15,12 10,7"/><line x1="15" x2="3" y1="12" y2="12"/></svg>
                Access Leaderboard
            </button>
            <div id="authMessage" class="mt-2"></div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="mainApp" class="hidden">
        <div class="app-header">
            <h1 class="app-title">
                <svg class="lucide lucide-lg" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="8" cy="8" r="2"/><path d="M13.2 17.7c.4-.4.8-.8 1.2-1.2"/><circle cx="16" cy="16" r="2"/></svg>
                POOL LEADERBOARD
            </h1>
            <div class="app-subtitle">Live ELO Rankings & Game Tracking</div>
            <div class="user-info">
                <svg class="lucide" viewBox="0 0 24 24"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                Logged in as: <span class="user-name" id="currentUser"></span>
                <button id="logoutBtn" class="btn btn-secondary btn-small">
                    <svg class="lucide" style="width: 14px; height: 14px;" viewBox="0 0 24 24"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16,17 21,12 16,7"/><line x1="21" x2="9" y1="12" y2="12"/></svg>
                    Logout
                </button>
            </div>
        </div>

        <!-- Leaderboard Section -->
        <div class="leaderboard">
            <div class="leaderboard-header">
                <h2 class="leaderboard-title">
                    <svg class="lucide" viewBox="0 0 24 24"><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6"/><path d="M18 9h1.5a2.5 2.5 0 0 0 0-5H18"/><path d="M4 22h16"/><path d="M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22"/><path d="M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22"/><path d="M18 2H6v7a6 6 0 0 0 12 0V2Z"/></svg>
                    Current Rankings
                </h2>
            </div>
            <div id="leaderboardContent">
                <div class="loading">
                    <div class="spinner"></div>Loading leaderboard...
                </div>
            </div>
        </div>

        <!-- Game Recording Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">
                    <svg class="lucide" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="16" x2="8" y1="13" y2="13"/><line x1="16" x2="8" y1="17" y2="17"/><polyline points="10,9 9,9 8,9"/></svg>
                    Record New Game
                </h2>
            </div>
            <div class="section-content">
                <form id="gameForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Winner</label>
                            <select id="winnerSelect" class="form-select" required>
                                <option value="">Select winner...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Loser</label>
                            <select id="loserSelect" class="form-select" required>
                                <option value="">Select loser...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Game Margin</label>
                            <select id="marginSelect" class="form-select" required>
                                <option value="close">Close Game</option>
                                <option value="comfortable">Comfortable Win</option>
                                <option value="decisive">Decisive Win</option>
                            </select>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <svg class="lucide" viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg>
                        Record Game
                    </button>
                    
                    <div class="margin-info">
                        <h4>Game Margin Guide:</h4>
                        <ul>
                            <li><strong>Close game:</strong> Losing player is on the black</li>
                            <li><strong>Comfortable win:</strong> The losing player has 2 or less balls</li>
                            <li><strong>Decisive win:</strong> The losing player has 3 or more balls</li>
                        </ul>
                        <div class="black-pot-rule">
                            *If a player pots the black, the winning player is considered to have potted all their balls.
                        </div>
                    </div>
                </form>
                <div id="gameMessage" class="mt-2"></div>
            </div>
        </div>

        <!-- Add Player Section -->
        <div class="section add-player">
            <div class="section-header">
                <h2 class="section-title">
                    <svg class="lucide" viewBox="0 0 24 24"><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
                    Add New Player
                </h2>
            </div>
            <div class="section-content">
                <form id="addPlayerForm">
                    <div class="form-row-two">
                        <div class="form-group">
                            <label class="form-label">Player Name</label>
                            <input type="text" id="newPlayerName" class="form-input" placeholder="Enter new player name" required>
                        </div>
                        <div class="form-group">
                            <button type="submit" class="btn btn-primary" style="margin-top: 1.5rem;">
                                <svg class="lucide" viewBox="0 0 24 24"><path d="M5 12h14"/><path d="M12 5v14"/></svg>
                                Add Player
                            </button>
                        </div>
                    </div>
                </form>
                <div id="addPlayerMessage" class="mt-1"></div>
            </div>
        </div>

        <!-- Recent Games Section -->
        <div class="section">
            <div class="section-header">
                <h2 class="section-title">
                    <svg class="lucide" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><polyline points="12,6 12,12 16,14"/></svg>
                    Recent Games
                </h2>
            </div>
            <div class="section-content">
                <div id="recentGamesContent">
                    <div class="loading">
                        <div class="spinner"></div>Loading recent games...
                    </div>
                </div>
            </div>
        </div>

        <!-- Rules Section -->
        <div class="section rules-section">
            <div class="section-header">
                <h2 class="section-title">
                    <svg class="lucide" viewBox="0 0 24 24"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14,2 14,8 20,8"/><line x1="9" x2="15" y1="15" y2="15"/></svg>
                    Pool Rules
                </h2>
            </div>
            <div class="rules-content">
                <h4>Standard English Pub Pool Rules</h4>
                <ul>
                    <li>Players are assigned either spots (1-7) or stripes (9-15) after the break</li>
                    <li>Must pocket all your group balls before attempting the 8-ball</li>
                    <li>Call your pocket when shooting the 8-ball</li>
                    <li>Potting the white ball results in ball-in-hand for your opponent</li>
                    <li>Potting the 8-ball out of turn or in the wrong pocket loses the game</li>
                    <li>Jump shots and masse shots are allowed</li>
                    <li>No need to call obvious shots, only the 8-ball pocket</li>
                </ul>
                
                <h4>ELO Rating System</h4>
                <p>Players start with ratings based on the current average (around 1260). 
                   Ratings change based on game results, with larger changes for new players 
                   and closer games having smaller rating swings.</p>
            </div>
        </div>
    </div>
</div>

<script>
// App State
let currentUser = null;
let players = [];
let previousPlayerPositions = new Map();
let previousPlayerRatings = new Map();

// DOM Elements
const authScreen = document.getElementById('authScreen');
const mainApp = document.getElementById('mainApp');
const playerNameInput = document.getElementById('playerNameInput');
const loginBtn = document.getElementById('loginBtn');
const logoutBtn = document.getElementById('logoutBtn');
const currentUserSpan = document.getElementById('currentUser');
const authMessage = document.getElementById('authMessage');
const leaderboardContent = document.getElementById('leaderboardContent');
const gameForm = document.getElementById('gameForm');
const winnerSelect = document.getElementById('winnerSelect');
const loserSelect = document.getElementById('loserSelect');
const gameMessage = document.getElementById('gameMessage');
const recentGamesContent = document.getElementById('recentGamesContent');
const addPlayerForm = document.getElementById('addPlayerForm');
const newPlayerNameInput = document.getElementById('newPlayerName');
const addPlayerMessage = document.getElementById('addPlayerMessage');

// Utility Functions
function showMessage(element, message, type = 'info') {
    const iconSvg = type === 'success' ? 
        '<svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><path d="M20 6 9 17l-5-5"/></svg>' :
        type === 'error' ?
        '<svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></svg>' :
        '<svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>';
    
    element.innerHTML = `<div class="message message-${type}">${iconSvg}${message}</div>`;
    setTimeout(() => {
        element.innerHTML = '';
    }, 5000);
}

function formatDateTime(isoString) {
    const date = new Date(isoString);
    return date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
}

function getRatingClass(rating) {
    if (rating >= 1400) return 'rating-high';
    if (rating == 1000) return 'rating-medium';
    if (rating >= 1100) return 'rating-medium';
    return 'rating-low';
}

function isRecentGame(timestamp) {
    const gameTime = new Date(timestamp);
    const now = new Date();
    return (now - gameTime) < 20 * 60 * 1000; // 20 minutes
}

function animateSlotMachine(element, from, to, duration = 2000) {
    const change = Math.abs(to - from);
    
    // Create digit wrapper if it doesn't exist
    if (!element.querySelector('.rating-counter')) {
        const wrapper = document.createElement('span');
        wrapper.className = 'rating-counter';
        element.innerHTML = '';
        element.appendChild(wrapper);
    }
    
    const wrapper = element.querySelector('.rating-counter');
    
    // Choose animation based on change size
    const animationClass = change > 50 ? 'big-roll' : 'rolling';
    
    // Always pad to 4 digits for consistent slot machine effect
    const maxLength = 4;
    
    wrapper.innerHTML = '';
    
    // Create digit elements
    for (let i = 0; i < maxLength; i++) {
        const digitSpan = document.createElement('span');
        digitSpan.className = 'rating-digit';
        digitSpan.textContent = '0';
        wrapper.appendChild(digitSpan);
    }
    
    const digits = wrapper.querySelectorAll('.rating-digit');
    
    // Animate each digit
    const start = performance.now();
    
    function updateDigits(timestamp) {
        const progress = Math.min((timestamp - start) / duration, 1);
        const easeProgress = 1 - Math.pow(1 - progress, 3); // ease-out cubic
        const currentValue = Math.round(from + ((to - from) * easeProgress));
        const currentStr = currentValue.toString().padStart(maxLength, '0');
        
        // Update each digit with staggered animation
        digits.forEach((digit, index) => {
            const targetDigit = currentStr[index] || '0';
            if (digit.textContent !== targetDigit) {
                digit.textContent = targetDigit;
                
                // Add rolling animation with staggered timing
                if (progress > (index * 0.1)) {
                    digit.classList.add(animationClass);
                    setTimeout(() => digit.classList.remove(animationClass), 600);
                }
            }
        });
        
        if (progress < 1) {
            requestAnimationFrame(updateDigits);
        } else {
            // Final cleanup - keep padded zeros for consistency
            wrapper.textContent = to.toString().padStart(maxLength, '0');
        }
    }
    
    requestAnimationFrame(updateDigits);
}

// Authentication Functions
async function authenticate() {
    const name = playerNameInput.value.trim();
    if (!name) {
        showMessage(authMessage, 'Please enter your name', 'error');
        return;
    }

    try {
        const response = await fetch('/api/pool-leaderboard/authenticate', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ name: name })
        });

        const result = await response.json();

        if (response.ok) {
            currentUser = name.toLowerCase();
            currentUserSpan.textContent = name;
            authScreen.classList.add('hidden');
            mainApp.classList.remove('hidden');
            
            // Load initial data
            await loadLeaderboard();
            await loadRecentGames();
            
        } else {
            showMessage(authMessage, result.error || 'Authentication failed', 'error');
        }
    } catch (error) {
        showMessage(authMessage, 'Connection error. Please try again.', 'error');
    }
}

function logout() {
    currentUser = null;
    playerNameInput.value = '';
    authMessage.innerHTML = '';
    gameMessage.innerHTML = '';
    addPlayerMessage.innerHTML = '';
    mainApp.classList.add('hidden');
    authScreen.classList.remove('hidden');
}

// Data Loading Functions
async function loadLeaderboard() {
    try {
        const response = await fetch('/api/pool-leaderboard/players');
        const result = await response.json();
        
        if (response.ok) {
            // Store previous positions
            const newPositions = new Map();
            result.players.forEach((player, index) => {
                newPositions.set(player.name, index + 1);
            });
            
            players = result.players;
            displayLeaderboard(players, newPositions);
            updatePlayerSelects(players);
            
            previousPlayerPositions = newPositions;
        } else {
            leaderboardContent.innerHTML = `<div class="message message-error">
                <svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></svg>
                Error loading leaderboard: ${result.error}
            </div>`;
        }
    } catch (error) {
        leaderboardContent.innerHTML = `<div class="message message-error">
            <svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></svg>
            Connection error loading leaderboard
        </div>`;
    }
}

function displayLeaderboard(players, newPositions) {
    if (players.length === 0) {
        leaderboardContent.innerHTML = `<div class="message message-info">
            <svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            No players found
        </div>`;
        return;
    }

    let html = `
        <table class="leaderboard-table">
            <thead>
                <tr>
                    <th>Rank</th>
                    <th>Player</th>
                    <th>ELO</th>
                    <th>Games</th>
                    <th>W-L</th>
                    <th>Win%</th>
                </tr>
            </thead>
            <tbody>
    `;

    players.forEach((player, index) => {
        const rank = index + 1;
        const rankClass = rank <= 3 ? `rank-${rank}` : '';
        const ratingClass = getRatingClass(player.rating);
        
        // Check for position changes
        const prevPosition = previousPlayerPositions.get(player.name);
        let positionClass = '';
        if (prevPosition && prevPosition !== rank) {
            positionClass = prevPosition > rank ? 'position-up' : 'position-down';
        }
        
        html += `
            <tr class="leaderboard-row ${positionClass}" data-player="${player.name}">
                <td class="rank ${rankClass}">${rank}</td>
                <td class="player-name">${player.name}</td>
                <td class="rating ${ratingClass}" data-rating="${player.rating}">${player.rating}</td>
                <td class="games-stats">${player.games_played}</td>
                <td class="games-stats">${player.wins}-${player.losses}</td>
                <td class="win-rate">${player.win_rate}%</td>
            </tr>
        `;
    });

    html += `
            </tbody>
        </table>
    `;

    leaderboardContent.innerHTML = html;
    
    // Animate rating numbers with slot machine effect if they've changed
    const ratingCells = document.querySelectorAll('[data-rating]');
    ratingCells.forEach(cell => {
        const newRating = parseInt(cell.dataset.rating);
        const playerName = cell.closest('tr').dataset.player;
        
        // Get previous rating if available
        const previousRating = previousPlayerRatings.get(playerName) || newRating;
        
        // Only animate if rating actually changed
        if (previousRating !== newRating) {
            setTimeout(() => {
                animateSlotMachine(cell, previousRating, newRating, 2000);
            }, 300);
        }
        
        // Store current rating for next update
        previousPlayerRatings.set(playerName, newRating);
    });
}

function updatePlayerSelects(players) {
    const winnerOptions = '<option value="">Select winner...</option>' + 
        players.map(p => `<option value="${p.name}">${p.name} (${p.rating})</option>`).join('');
    const loserOptions = '<option value="">Select loser...</option>' + 
        players.map(p => `<option value="${p.name}">${p.name} (${p.rating})</option>`).join('');
    
    winnerSelect.innerHTML = winnerOptions;
    loserSelect.innerHTML = loserOptions;
}

async function loadRecentGames() {
    try {
        const response = await fetch('/api/pool-leaderboard/recent-games');
        const result = await response.json();
        
        if (response.ok) {
            displayRecentGames(result.games);
        } else {
            recentGamesContent.innerHTML = `<div class="message message-error">
                <svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></svg>
                Error loading recent games
            </div>`;
        }
    } catch (error) {
        recentGamesContent.innerHTML = `<div class="message message-error">
            <svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><line x1="15" x2="9" y1="9" y2="15"/><line x1="9" x2="15" y1="9" y2="15"/></svg>
            Connection error loading games
        </div>`;
    }
}

function displayRecentGames(games) {
    if (games.length === 0) {
        recentGamesContent.innerHTML = `<div class="message message-info">
            <svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
            No recent games found
        </div>`;
        return;
    }

    let html = '<div class="recent-games">';
    
    games.forEach(game => {
        html += `
            <div class="game-item">
                <div class="game-result">
                    <div class="game-match">
                        <span class="game-winner">${game.winner}</span> def. 
                        <span class="game-loser">${game.loser}</span>
                    </div>
                    <div class="game-margin">${game.margin} game</div>
                </div>
                <div class="game-ratings">
                    <div class="rating-change">
                        <span>${game.winner}</span>
                        <span class="rating-change-positive">+${game.winner_change}</span>
                        <small>${game.winner_rating_after}</small>
                    </div>
                    <div class="rating-change">
                        <span>${game.loser}</span>
                        <span class="rating-change-negative">${game.loser_change}</span>
                        <small>${game.loser_rating_after}</small>
                    </div>
                </div>
                <div class="game-time">${formatDateTime(game.timestamp)}</div>
            </div>
        `;
    });
    
    // Add delete most recent game button
    const mostRecentGame = games[0];
    const canDeleteMostRecent = mostRecentGame && isRecentGame(mostRecentGame.timestamp);
    
    html += `
        <button class="delete-recent-btn" ${!canDeleteMostRecent ? 'disabled' : ''} onclick="deleteGame(${mostRecentGame ? mostRecentGame.id : 0})">
            <svg class="lucide" style="width: 16px; height: 16px;" viewBox="0 0 24 24"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/><line x1="10" x2="10" y1="11" y2="17"/><line x1="14" x2="14" y1="11" y2="17"/></svg>
            Delete Most Recent Game
        </button>
    `;
    
    html += '</div>';
    recentGamesContent.innerHTML = html;
}

// Game Recording
async function recordGame(event) {
    event.preventDefault();
    
    const winner = winnerSelect.value;
    const loser = loserSelect.value;
    const margin = document.getElementById('marginSelect').value;
    
    if (!winner || !loser) {
        showMessage(gameMessage, 'Please select both winner and loser', 'error');
        return;
    }
    
    if (winner === loser) {
        showMessage(gameMessage, 'Winner and loser cannot be the same player', 'error');
        return;
    }
    
    try {
        const response = await fetch('/api/pool-leaderboard/record-game', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ winner, loser, margin })
        });
        
        const result = await response.json();
        
        if (response.ok) {
            showMessage(gameMessage, `Game recorded! ${winner} (${result.winner_new_rating}) def. ${loser} (${result.loser_new_rating})`, 'success');
            gameForm.reset();
            
            // Reload data
            await loadLeaderboard();
            await loadRecentGames();
        } else {
            showMessage(gameMessage, result.error || 'Error recording game', 'error');
        }
    } catch (error) {
        showMessage(gameMessage, 'Connection error recording game', 'error');
    }
}

// Add Player
async function addPlayer(event) {
    event.preventDefault();
    
    const name = newPlayerNameInput.value.trim();
    if (!name) {
        showMessage(addPlayerMessage, 'Please enter a player name', 'error');
        return;
    }
    
    try {
        // Get average rating first
        const avgResponse = await fetch('/api/pool-leaderboard/average-rating');
        const avgResult = await avgResponse.json();
        const initialRating = avgResult.average_rating || 1200;
        
        const response = await fetch('/api/pool-leaderboard/add-player', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ 
                name: name,
                initial_rating: initialRating
            })
        });
        
        const result = await response.json();
        
        if (response.ok) {
            showMessage(addPlayerMessage, `Player ${name} added with ${initialRating} ELO (average rating)`, 'success');
            addPlayerForm.reset();
            
            // Reload data
            await loadLeaderboard();
        } else {
            showMessage(addPlayerMessage, result.error || 'Error adding player', 'error');
        }
    } catch (error) {
        showMessage(addPlayerMessage, 'Connection error adding player', 'error');
    }
}

// Delete Game
async function deleteGame(gameId) {
    console.log('Deleting game with ID:', gameId);
    
    if (!gameId) {
        showMessage(gameMessage, 'No game ID provided', 'error');
        return;
    }
    
    if (!confirm('Are you sure you want to delete this game? This will restore the previous ratings.')) {
        return;
    }
    
    try {
        const response = await fetch('/api/pool-leaderboard/delete-game', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify({ game_id: parseFloat(gameId) })
        });
        
        const result = await response.json();
        
        if (response.ok) {
            showMessage(gameMessage, 'Game deleted and ratings restored', 'success');
            
            // Reload data
            await loadLeaderboard();
            await loadRecentGames();
        } else {
            showMessage(gameMessage, result.error || 'Error deleting game', 'error');
        }
    } catch (error) {
        console.error('Delete error:', error);
        showMessage(gameMessage, 'Connection error deleting game', 'error');
    }
}

// Event Listeners
loginBtn.addEventListener('click', authenticate);
logoutBtn.addEventListener('click', logout);
gameForm.addEventListener('submit', recordGame);
addPlayerForm.addEventListener('submit', addPlayer);

// Enter key support for login
playerNameInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        authenticate();
    }
});

// Auto-refresh leaderboard every 30 seconds
setInterval(async () => {
    if (currentUser && !mainApp.classList.contains('hidden')) {
        await loadLeaderboard();
        await loadRecentGames();
    }
}, 30000);

// Initialize data on page load
document.addEventListener('DOMContentLoaded', async () => {
    // Try to initialize data (this will fail if already initialized, which is fine)
    try {
        await fetch('/api/pool-leaderboard/init-data', { method: 'POST' });
    } catch (error) {
        // Ignore errors - data might already be initialized
    }
});
</script>
</html>
</body>
</html>